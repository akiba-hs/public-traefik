{{- $p := env "TG_PUBLIC_PREFIX" -}}
{{- $t := env "TG_BOT_TOKEN" -}}

http:
  routers:
    mintlify-root:
      rule: Host(`akiba.space`)
      entryPoints: [websecure]
      service: mintlify-app
      middlewares: [chat-redirect, mintlify-headers-app]
    telegram-bot-api:
      rule: 'Host(`tgapi.akiba.space`) && PathPrefix(`/bot{{ $p }}/`)'
      entryPoints: [websecure]
      middlewares: [tg-strip-public, tg-add-bot-token]
      service: telegram-bot-api
      tls: {}
      observability:
        accessLogs: false

  middlewares:
    mintlify-headers-app:
      headers:
        customRequestHeaders:
          Origin: akibahackspace.mintlify.app
    chat-redirect:
      redirectRegex:
        regex: ^https?://akiba\.space/chat$
        replacement: https://t.me/+e949BIUkRV8xODZi
        permanent: false
    tg-strip-public:
      stripPrefix:
        prefixes:
          - /bot{{ $p }}
    tg-add-bot-token:
      addPrefix:
        prefix: /bot{{ $t }}

  services:
    mintlify-app:
      loadBalancer:
        passHostHeader: false
        servers:
          - url: https://akibahackspace.mintlify.app
    telegram-bot-api:
      loadBalancer:
        passHostHeader: false
        servers:
          - url: https://api.telegram.org